<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Udacity Todos Goals</title>
</head>
<body>
<div>
    <h1>Todo List</h1>
    <input id="todo" type="text" placeholder="Add Todo"/>
    <button id="todoBtn">Add Todo</button>
    <ul id="todos"></ul>
</div>
<div>
    <h1>Goal List</h1>
    <input id="goal" type="text" placeholder="Add Goal"/>
    <button id="goalBtn">Add Goal</button>
    <ul id="goals"></ul>
</div>
<script type="text/javascript" src="store/CustomStore.js"></script>
<script type="text/javascript">
    // Create the store and provide a root reducer
    const store = createStore(rootReducer)

    store.subscribe(() => {
        const {todos, goals} = store.getState()

        document.getElementById('todos').innerHTML = ''
        document.getElementById('goals').innerHTML = ''
        todos.forEach(addTodoToDOM)
        goals.forEach(addGoalToDOM)
    })

    function generateId() {
        return Math.random().toString(36).substring(2) + (new Date()).getTime().toString(36);
    }

    function addTodo() {
        const input = document.getElementById('todo')
        const name = input.value
        input.value = ''
        store.dispatch(addTodoAction({
            name,
            complete: false,
            id: generateId()
        }))
    }

    function addGoal() {
        const input = document.getElementById('goal')
        const name = input.value
        input.value = ''
        store.dispatch(addGoalAction({
            name,
            id: generateId()
        }))
    }

    document.getElementById('todoBtn').addEventListener('click', addTodo)
    document.getElementById('goalBtn').addEventListener('click', addGoal)

    const createRemoveButton = (onClick) => {
        const deleteButton = document.createElement('button')
        deleteButton.innerHTML = 'X'
        deleteButton.addEventListener('click', onClick)
        return deleteButton
    }

    const addTodoToDOM = (todo) => {
        const node = document.createElement('li')
        node.id = todo.id
        const textNode = document.createTextNode(todo.name)

        node.appendChild(textNode)
        const removeBtn = createRemoveButton(() => store.dispatch(removeTodoAction(todo.id)))
        node.appendChild(removeBtn)

        node.style.textDecoration = todo.complete ? 'line-through' : 'none'
        node.addEventListener("click", () => store.dispatch(toggleTodoAction(todo.id)))
        document.getElementById('todos').appendChild(node)
    }

    const addGoalToDOM = (goal) => {
        const node = document.createElement('li')
        const textNode = document.createTextNode(goal.name)
        node.appendChild(textNode)
        const removeBtn = createRemoveButton(() => store.dispatch(removeGoalAction(goal.id)))
        node.appendChild(removeBtn)

        document.getElementById('goals').appendChild(node)
    }
</script>
</body>
</html>